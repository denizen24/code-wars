Middleware в Express.js — это функции, которые имеют доступ к объектам запроса (req), ответа (res) и следующей функции в цикле обработки запроса (next). Middleware функции могут выполнять различные задачи, такие как выполнение кода, изменение объекта запроса и ответа, завершение запроса и вызов следующей middleware функции в стеке.

### Основные характеристики middleware:

1. Функциональность: Middleware может выполнять различные задачи, включая обработку запросов, аутентификацию, логирование, обработку ошибок и многое другое.

2. Порядок выполнения: Middleware выполняются в порядке, в котором они были добавлены в приложение. Это позволяет контролировать, какие функции выполняются для каждого запроса.

3. Возможность завершения запроса: Middleware может завершить обработку запроса, отправив ответ клиенту, или передать управление следующему middleware с помощью функции next().

### Примеры использования middleware

#### 1. Простой middleware

Создание простого middleware, который логирует информацию о каждом запросе:
````javascript
const express = require('express');
const app = express();

// Простой middleware для логирования
app.use((req, res, next) => {
    console.log(${req.method} ${req.url});
    next(); // Передаем управление следующему middleware
});

// Пример маршрута
app.get('/', (req, res) => {
    res.send('Hello, World!');
});

app.listen(3000, () => {
    console.log('Server is running on port 3000');
});
````



#### 2. Middleware для обработки JSON

Express.js имеет встроенное middleware для обработки JSON-данных, которое позволяет обрабатывать запросы с телом в формате JSON.
```javascript
app.use(express.json()); // Встроенное middleware для обработки JSON

app.post('/data', (req, res) => {
    console.log(req.body); // Доступ к данным из тела запроса
    res.send('Data received');
});
```



#### 3. Middleware для аутентификации

Создание middleware для проверки аутентификации пользователя:
```javascript
function authenticate(req, res, next) {
    const token = req.headers['authorization'];
    if (token) {
    // Логика проверки токена
        next(); // Если аутентификация успешна, передаем управление
    } else {
        res.status(401).send('Unauthorized'); // Если нет токена, отправляем ошибку
    }
}

app.use(authenticate); // Применяем middleware ко всем маршрутам

```


#### 4. Middleware для обработки ошибок

Создание middleware для обработки ошибок:
```javascript
app.use((err, req, res, next) => {
    console.error(err.stack);
    res.status(500).send('Something broke!');
});
```



### Заключение

Middleware в Express.js является мощным инструментом для обработки запросов и управления потоком выполнения в приложении. Они позволяют добавлять функциональность, такую как логирование, аутентификация и обработка ошибок, а также упрощают структуру кода, разделяя различные аспекты обработки запросов. Использование middleware помогает сделать ваше приложение более организованным и поддерживаемым. 