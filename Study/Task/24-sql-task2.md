1. Вывести уникальные комбинации пользователя и id товара для всех покупок, совершенных пользователями до того, как их забанили.
   Отсортировать сначала по имени пользователя, потом по SKU

2. Найти пользователей, которые совершили покупок на сумму больше 5000р.
   Вывести их имена в формате id пользователя | имя | фамилия | сумма покупок

## User

| id | firstname | lastname | birth      |
|----|-----------|----------|------------|
| 1  | Ivan      | Petrov   | 1996-05-01 |
| 2  | Anna      | Petrova  | 1999-06-01 |
| 3  | Anna      | Petrova  | 1990-10-02 |

## Purchase

| sku | price | user_id | date       |
|-----|-------|---------|------------|
| 1   | 5500  | 1       | 2021-02-15 |
| 1   | 5700  | 1       | 2021-01-15 |
| 2   | 4000  | 1       | 2021-02-14 |
| 3   | 8000  | 2       | 2021-03-01 |
| 4   | 400   | 2       | 2021-03-02 |

## Ban List

| user_id | date_from  |
|---------|------------|
| 1       | 2021-03-08 |


Для выполнения указанных задач на SQL, предположим, что у нас есть три таблицы: user, purchase и ban_list. Мы будем использовать SQL-запросы для получения нужных данных. Давайте рассмотрим оба запроса по отдельности.

### 1. Уникальные комбинации пользователя и ID товара для всех покупок, совершенных пользователями до того, как их забанили

Для этого запроса мы будем использовать JOIN для соединения таблиц user, purchase и ban_list. Мы отфильтруем покупки пользователей, которые были забанены после даты покупки.
```
SELECT DISTINCT u.id AS user_id, p.sku
FROM user u
JOIN purchase p ON u.id = p.user_id
LEFT JOIN ban_list b ON u.id = b.user_id AND p.date < b.date_from
WHERE b.user_id IS NULL
ORDER BY u.firstname, p.sku;
```

### Пояснение:

- JOIN: Соединяем таблицы user и purchase по user_id.
- LEFT JOIN: Соединяем таблицу ban_list, чтобы найти записи о банах, которые произошли после даты покупки.
- WHERE b.user_id IS NULL: Фильтруем только тех пользователей, которые не были забанены на момент совершения покупки.
- DISTINCT: Убираем дубликаты, чтобы получить уникальные комбинации.
- ORDER BY: Сортируем результаты сначала по имени пользователя, а затем по SKU.

### 2. Найти пользователей, которые совершили покупок на сумму больше 5000р

Для этого запроса мы будем использовать GROUP BY для группировки покупок по пользователям и HAVING для фильтрации по общей сумме покупок.
```
SELECT u.id AS user_id, u.firstname, u.lastname, SUM(p.price) AS total_spent
FROM user u
JOIN purchase p ON u.id = p.user_id
GROUP BY u.id, u.firstname, u.lastname
HAVING SUM(p.price) > 5000;
```

### Пояснение:

- JOIN: Соединяем таблицы user и purchase по user_id.
- GROUP BY: Группируем результаты по id, firstname и lastname пользователя.
- SUM(p.price): Считаем общую сумму покупок для каждого пользователя.
- HAVING: Фильтруем пользователей, у которых общая сумма покупок превышает 5000 рублей.

### Заключение

Эти SQL-запросы позволяют получить требуемую информацию из базы данных, используя соединения таблиц и агрегацию данных.
